# Free Intelligence - IntakeCoach Preset
# LLM agent for medical intake conversations
#
# Philosophy: Structured extraction without mutation
# Output: JSON conforming to intake.schema.json

preset_id: "intake_coach"
version: "1.0.0"
created_at: "2025-10-28"
description: "Medical intake conversation agent with structured JSON output"

# LLM Configuration
llm:
  provider: "ollama"  # Can be overridden to "claude"
  model: "qwen2.5:7b-instruct-q4_0"
  temperature: 0.3  # Lower temperature for consistent extraction
  max_tokens: 2048
  stream: false

# System Prompt
system_prompt: |
  You are an IntakeCoach, a medical intake assistant for Free Intelligence.

  Your role is to extract structured medical information from patient conversations
  and output valid JSON conforming to the intake schema.

  Guidelines:
  1. Extract demographics (name, age, gender, contact)
  2. Capture chief complaint and symptoms
  3. Record medical history (allergies, medications, conditions)
  4. Note urgency level (LOW, MODERATE, HIGH, CRITICAL)
  5. NEVER add information not explicitly mentioned by the patient
  6. Use null for missing/unknown fields
  7. Output ONLY valid JSON, no explanations

  Output format:
  {
    "demographics": {
      "name": "string or null",
      "age": number or null,
      "gender": "M" | "F" | "O" | null,
      "contact": "string or null"
    },
    "chief_complaint": "string or null",
    "symptoms": ["list of symptoms"],
    "medical_history": {
      "allergies": ["list"],
      "medications": ["list"],
      "conditions": ["list"]
    },
    "urgency": "LOW" | "MODERATE" | "HIGH" | "CRITICAL",
    "notes": "string or null"
  }

# Output Schema Reference
output_schema: "schemas/intake.schema.json"

# Validation
validation:
  enabled: true
  strict: true  # Reject output if it doesn't match schema
  log_errors: true

# Caching
cache:
  enabled: true
  ttl_seconds: 3600  # 1 hour
  key_fields:
    - "prompt"
    - "temperature"
    - "model"

# Examples (for few-shot learning)
examples:
  - prompt: |
      Patient: Hi, I'm John Doe, 45 years old. I've been having chest pain for the last 2 hours.
      It's sharp and radiates to my left arm. I have high blood pressure and take lisinopril.
    output: |
      {
        "demographics": {
          "name": "John Doe",
          "age": 45,
          "gender": null,
          "contact": null
        },
        "chief_complaint": "Chest pain for 2 hours",
        "symptoms": ["chest pain (sharp)", "pain radiating to left arm"],
        "medical_history": {
          "allergies": [],
          "medications": ["lisinopril"],
          "conditions": ["hypertension"]
        },
        "urgency": "CRITICAL",
        "notes": "Possible acute coronary syndrome - requires immediate evaluation"
      }

  - prompt: |
      Patient: I'm Sarah, 28 years old. I have a headache that started this morning.
      I'm allergic to penicillin.
    output: |
      {
        "demographics": {
          "name": "Sarah",
          "age": 28,
          "gender": null,
          "contact": null
        },
        "chief_complaint": "Headache since morning",
        "symptoms": ["headache"],
        "medical_history": {
          "allergies": ["penicillin"],
          "medications": [],
          "conditions": []
        },
        "urgency": "LOW",
        "notes": null
      }

  - prompt: |
      Patient: My 5-year-old daughter has fever of 102F for 2 days, cough, and difficulty breathing.
    output: |
      {
        "demographics": {
          "name": null,
          "age": 5,
          "gender": "F",
          "contact": null
        },
        "chief_complaint": "Fever, cough, difficulty breathing for 2 days",
        "symptoms": ["fever (102F)", "cough", "difficulty breathing"],
        "medical_history": {
          "allergies": [],
          "medications": [],
          "conditions": []
        },
        "urgency": "HIGH",
        "notes": "Pediatric patient with respiratory distress - requires urgent evaluation"
      }

# Metadata
metadata:
  author: "Bernard Uriza Orozco"
  sprint: "SPR-2025W44"
  trello_card: "69007450f09a0f2252d7819a"
